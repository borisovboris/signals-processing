import{a as Vt}from"./chunk-RXVEORVH.js";import{b as Ut,f as N,g as Dt,h as Y,l as Pt,m as Et,n as bt,o as Qt,p as kt}from"./chunk-OTL7X6PS.js";import{a as I,b as le,c as F,d as pe,e as me}from"./chunk-SPCOMQNX.js";import{c as X}from"./chunk-GPDQWZDE.js";import{a as Ft,b as de}from"./chunk-2JCW2XGL.js";import{a as nt,d as f,e as re,q as k,t as W,u as ae,v as ce,x as q,y as se}from"./chunk-7FJ4ADOC.js";import{$b as K,B as et,C as te,Ca as B,D as it,E as ot,Ea as _,Ec as A,Ga as y,Ja as l,Jb as pt,Ka as b,Kb as Q,L as g,La as G,Lb as mt,Mb as ut,N as Jt,Na as V,P as ee,Qb as R,Ra as Gt,S as At,Sa as zt,T as J,Ta as qt,U as E,Vb as j,Wa as U,Wb as ft,X as x,Xb as Ct,Y as M,Za as L,Zb as ht,_b as gt,a as D,ac as yt,b as P,bc as _t,cc as vt,da as ct,dc as z,ec as xt,gc as Mt,ia as d,ic as wt,ja as u,jc as Ot,ka as T,kc as St,l as O,la as st,lc as It,mb as Bt,mc as ne,n as Lt,nb as oe,oa as $t,ob as lt,q as C,qa as m,ra as ie,sa as w,ta as dt,u as Z,v as S,x as $,xa as s,y as tt,ya as c,za as v}from"./chunk-OWV6CK4N.js";var rt=ae(Ut),ue=W(rt,o=>o.countries),fe=W(rt,o=>o.cities),Ce=W(rt,o=>o.locations),he=W(rt,o=>o.cityFilters),ge=W(rt,o=>o.countriesOffset),ye=W(rt,o=>o.currentlyViewedCountry),_e=W(rt,o=>o.currentlyViewedCity);var a=re({source:"Country",events:{"Get Countries":(o=0)=>({offset:o}),"Countries Fetched":f(),"Get country":f(),"Country fetched":f(),"Get Cities Of Country":(o={})=>({filters:o}),"Cities Of Country Fetched":f(),"Get Locations":f(),"Locations Fetched":f(),"Create country":f(),"Country created":f(),"Create city":f(),"City created":f(),"Get city":f(),"City fetched":f(),"Create location":f(),"Location created":f(),"Delete country":f(),"Country deleted":f(),"Delete city":f(),"City deleted":f(),"Delete location":f(),"Location deleted":f(),"Edit country":f(),"Country edited":f(),"Edit city":f(),"City edited":f(),"Edit location":f(),"Location edited":f()}});function Ve(o,n){o&1&&(s(0,"mat-error"),l(1,"Country already exists"),c())}var Wt=(()=>{let n=class n{uniqueCountryValidatorFn(){return t=>t.valueChanges.pipe($(400),et(),g(e=>this.service.checkIfCountryExists(e).pipe(C(i=>[i,e]))),C(([e,i])=>e&&!Y(this.dialogData?.name,i)?{countryExists:!0}:null),ot(),it(()=>this.changeRef.markForCheck()))}constructor(t,e,i,r){this.service=t,this.changeRef=e,this.store=i,this.injector=r,this.dialogData=J(Et),this.dialogRef=this.injector.get(Pt),this.matcher=new Dt,this.inEditMode=!1,this.countryForm=new vt({countryName:new z("",{validators:[K.required],asyncValidators:[this.uniqueCountryValidatorFn().bind(this)]})}),this.dialogData?.name!==void 0&&(this.countryName?.setValue(this.dialogData.name),this.inEditMode=!0)}get countryName(){return this.countryForm.get("countryName")}saveCountry(){this.inEditMode?this.editCountry():this.createCountry()}editCountry(){let t=this.dialogData?.id,e=this.countryName?.value;t&&e&&(this.store.dispatch(a.editCountry({country:{id:t,name:e}})),this.dialogRef.close(!0))}createCountry(){let t=this.countryName?.value;N(t)&&(this.store.dispatch(a.createCountry({name:t})),this.dialogRef.close(!0))}countryChangedThroughEdit(){return!Y(this.countryName?.value,this.dialogData?.name)}formPending(){return this.countryForm.pending}};n.\u0275fac=function(e){return new(e||n)(u(X),u(T),u(k),u(ct))},n.\u0275cmp=E({type:n,selectors:[["app-country-form"]],standalone:!0,features:[V],decls:12,vars:6,consts:[[3,"formGroup","ngSubmit"],[1,"example-full-width"],["formControlName","countryName","matInput","",3,"errorStateMatcher"],[4,"ngIf"],[1,"actions"],["mat-raised-button","","color","accent",3,"disabled"]],template:function(e,i){e&1&&(s(0,"mat-card")(1,"h1"),l(2),c(),s(3,"form",0),_("ngSubmit",function(){return i.saveCountry()}),s(4,"mat-form-field",1)(5,"mat-label"),l(6,"Country name"),c(),v(7,"input",2),w(8,Ve,2,0,"mat-error",3),c(),s(9,"div",4)(10,"button",5),l(11),c()()()()),e&2&&(d(2),b(i.inEditMode?"Edit country":"Add country"),d(1),m("formGroup",i.countryForm),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.countryName==null?null:i.countryName.hasError("countryExists")),d(2),m("disabled",i.countryForm.invalid||!i.countryChangedThroughEdit()||i.formPending()),d(1),G(" ",i.inEditMode?"Edit":"Add"," "))},dependencies:[A,R,j,ht,ft,Ct,It,Ot,xt,gt,yt,_t,St,Mt,wt,L,U],styles:["mat-card[_ngcontent-%COMP%]{padding:20px 16px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:26px}mat-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:space-between}"],changeDetection:0});let o=n;return o})();function ke(o,n){if(o&1){let p=B();s(0,"div",9),_("click",function(){let i=x(p).$implicit,r=y(2);return M(r.goToDetails(i.id))}),s(1,"div",10)(2,"p"),l(3),c(),s(4,"app-list-actions",11),_("delete",function(){let i=x(p).$implicit,r=y(2);return M(r.deleteCountry(i.id))})("edit",function(){let i=x(p).$implicit,r=y(2);return M(r.openCountryFormForEdit(i.id,i.name))}),c()()()}if(o&2){let p=n.$implicit;d(3),b(p.name)}}function Ne(o,n){if(o&1){let p=B();s(0,"div",4)(1,"div",5)(2,"p"),l(3,"Name"),c(),s(4,"p"),l(5,"Actions"),c()(),s(6,"div",6)(7,"cdk-virtual-scroll-viewport",7),_("scrolledIndexChange",function(){x(p);let e=y();return M(e.onScroll())}),w(8,ke,5,1,"div",8),c()()()}if(o&2){let p=y();m("@fadeIn",void 0),d(7),m("itemSize",68),d(1),m("cdkVirtualForOf",p.countries)}}function Te(o,n){o&1&&v(0,"app-no-data")}var Ie=(()=>{let n=class n extends Qt{constructor(t,e,i,r){super(),this.store=t,this.router=e,this.dialogService=i,this.changeRef=r,this.destroyedRef=J(st)}ngOnInit(){this.store.dispatch(a.getCountries()),this.scrolled$.pipe($(300)).subscribe(()=>this.getOffset()),this.store.select(ue).pipe(nt(this.destroyedRef)).subscribe(t=>{this.countries=t,this.changeRef.markForCheck()})}getNewBatch(){this.store.dispatch(a.getCountries(this.offset))}goToDetails(t){this.router.navigate(["countries",t])}openCountryFormForCreation(){let t=this.dialogService.open(Wt);this.onDialogClosed(t)}openCountryFormForEdit(t,e){let i={id:t,name:e},r=this.dialogService.open(Wt,{data:i});this.onDialogClosed(r)}onDialogClosed(t){t.afterClosed().pipe(tt(1),Z(e=>e===!0)).subscribe(()=>this.offset=0)}deleteCountry(t){this.store.dispatch(a.deleteCountry({id:t})),this.offset=0}};n.\u0275fac=function(e){return new(e||n)(u(k),u(lt),u(bt),u(T))},n.\u0275cmp=E({type:n,selectors:[["app-country-list"]],viewQuery:function(e,i){if(e&1&&zt(Q,5),e&2){let r;Gt(r=qt())&&(i.viewport=r.first)}},standalone:!0,features:[$t,V],decls:9,vars:1,consts:[[1,"wrapper"],[1,"heading"],["mat-raised-button","","color","accent",3,"click"],["class","table"],[1,"table"],[1,"columns"],[1,"list-wrapper"],["CdkScrollable","",3,"itemSize","scrolledIndexChange"],["class","row-wrapper",3,"click",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"row-wrapper",3,"click"],[1,"row","mat-elevation-z2"],[3,"delete","edit"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"mat-card")(2,"div",1)(3,"h2"),l(4,"Countries"),c(),s(5,"button",2),_("click",function(){return i.openCountryFormForCreation()}),l(6," Add country "),c()(),w(7,Ne,9,3,"div",3)(8,Te,1,0),c()()),e&2&&(d(7),dt(7,i.countries!==void 0&&i.countries.length>0?7:8))},dependencies:[L,A,R,j,ut,pt,mt,Q,Vt,kt],styles:[".row-wrapper[_ngcontent-%COMP%]{margin:0 45px;padding:10px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{padding:10px 0;background-color:#fff;display:flex;justify-content:space-evenly;align-items:center;border-radius:20px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:hover{cursor:pointer}.row-wrapper[_ngcontent-%COMP%]   .row.not-operational[_ngcontent-%COMP%]{background-color:#f0b3b3}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{scrollbar-gutter:stable both-edges}.columns[_ngcontent-%COMP%]{margin:0 76px;display:flex;justify-content:space-evenly}.columns[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;flex:1;font-size:20px;font-weight:500;color:#a9a9a9}.wrapper[_ngcontent-%COMP%]{padding:0 15vw;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}mat-card[_ngcontent-%COMP%]{padding:30px 0;background-color:#f2f8ef;height:100%;width:100%;overflow-y:hidden}mat-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.example-viewport, .table[_ngcontent-%COMP%], app-no-data)[_ngcontent-%COMP%]{margin-left:45px;margin-right:45px}mat-card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:0 15px 20px}"],data:{animation:[Ft]},changeDetection:0});let o=n;return o})();function Le(o,n){o&1&&(s(0,"mat-error"),l(1,"City name exists"),c())}function Re(o,n){o&1&&(s(0,"mat-error"),l(1,"Postal code exists"),c())}var Xt=(()=>{let n=class n{uniqueCityNameValidatorFn(){return t=>!t.valueChanges||t.pristine?Lt(null):t.valueChanges.pipe($(400),et(),g(e=>{let{countryId:i}=this.dialogData;return this.service.checkIfCityExists(i,e).pipe(C(r=>[r,e]))}),C(([e,i])=>e&&!Y(this.dialogData.name,i)?{countryExists:!0}:null),ot(),it(()=>this.changeRef.markForCheck()))}uniquePostalCodeValidatorFn(){return t=>!t.valueChanges||t.pristine?Lt(null):t.valueChanges.pipe($(400),et(),g(e=>{let{countryId:i}=this.dialogData;return this.service.checkIfPostalCodeExists(i,e).pipe(C(r=>[r,e]))}),C(([e,i])=>e&&!Y(this.dialogData.postalCode,i)?{postalCodeExists:!0}:null),ot(),it(()=>this.changeRef.markForCheck()))}constructor(t,e,i,r){this.service=t,this.changeRef=e,this.store=i,this.injector=r,this.dialogData=this.injector.get(Et),this.dialogRef=this.injector.get(Pt),this.matcher=new Dt,this.inEditMode=!1,this.cityForm=new vt({cityName:new z("",{validators:[K.required],asyncValidators:[this.uniqueCityNameValidatorFn().bind(this)]}),postalCode:new z("",{validators:[K.required],asyncValidators:[this.uniquePostalCodeValidatorFn().bind(this)]})});let h=this.dialogData.name,H=this.dialogData.postalCode;h!==void 0&&(this.inEditMode=!0,h&&H&&(this.cityForm.get("cityName")?.setValue(h),this.cityForm.get("postalCode")?.setValue(H)))}get cityName(){return this.cityForm.get("cityName")}get postalCode(){return this.cityForm.get("postalCode")}get formPending(){return this.cityForm.pending}saveCity(){this.inEditMode?this.editCity():this.createCity()}editCity(){let t=this.cityName?.value,e=this.postalCode?.value,{countryId:i}=this.dialogData,{cityId:r}=this.dialogData;t&&e&&i&&r&&(this.store.dispatch(a.editCity({city:{name:t,postalCode:e,countryId:i,id:r}})),this.dialogRef.close(!0))}createCity(){let t=this.cityName?.value,e=this.postalCode?.value,{countryId:i}=this.dialogData;if(N(t)&&N(e)){let r={name:t,postalCode:e,countryId:i};this.store.dispatch(a.createCity({city:r})),this.dialogRef.close(!0)}}get cityChangedThroughEdit(){let t=!Y(this.cityName?.value,this.dialogData?.name),e=!Y(this.postalCode?.value,this.dialogData?.postalCode);return t||e}};n.\u0275fac=function(e){return new(e||n)(u(X),u(T),u(k),u(ct))},n.\u0275cmp=E({type:n,selectors:[["app-city-form"]],standalone:!0,features:[V],decls:17,vars:8,consts:[[3,"formGroup","ngSubmit"],[1,"example-full-width"],["formControlName","cityName","matInput","",3,"errorStateMatcher"],[4,"ngIf"],["formControlName","postalCode","matInput","",3,"errorStateMatcher"],[1,"actions"],["mat-raised-button","","color","accent",3,"disabled"]],template:function(e,i){e&1&&(s(0,"mat-card")(1,"h1"),l(2),c(),s(3,"form",0),_("ngSubmit",function(){return i.saveCity()}),s(4,"mat-form-field",1)(5,"mat-label"),l(6,"City name"),c(),v(7,"input",2),w(8,Le,2,0,"mat-error",3),c(),s(9,"mat-form-field",1)(10,"mat-label"),l(11,"Postal code"),c(),v(12,"input",4),w(13,Re,2,0,"mat-error",3),c(),s(14,"div",5)(15,"button",6),l(16),c()()()()),e&2&&(d(2),b(i.inEditMode?"Edit city":"Add city"),d(1),m("formGroup",i.cityForm),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.cityName==null?null:i.cityName.hasError("countryExists")),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.postalCode==null?null:i.postalCode.hasError("postalCodeExists")),d(2),m("disabled",i.cityForm.invalid||i.formPending||!i.cityChangedThroughEdit),d(1),G(" ",i.inEditMode?"Edit":"Add"," "))},dependencies:[Ot,xt,gt,yt,_t,A,R,j,ht,ft,Ct,It,St,Mt,wt,L,U],styles:["mat-card[_ngcontent-%COMP%]{padding:20px 16px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:26px}mat-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:space-between}"],changeDetection:0});let o=n;return o})();function je(o,n){if(o&1){let p=B();s(0,"div",3)(1,"h2"),l(2),c(),s(3,"button",4),_("click",function(){x(p);let e=y();return M(e.openCityCreationForm())}),l(4," Add city "),c()()}if(o&2){let p=y();d(1),m("@fadeIn",void 0),d(1),G("Cities in ",p.currentCountry.name,"")}}function Ae(o,n){if(o&1){let p=B();s(0,"div",10),_("click",function(){let i=x(p).$implicit,r=y(2);return M(r.goToCity(i.id))}),s(1,"div",11)(2,"p"),l(3),c(),s(4,"app-list-actions",12),_("delete",function(){let i=x(p).$implicit,r=y(2);return M(r.deleteCity(i.id))})("edit",function(){let i=x(p).$implicit,r=y(2);return M(r.openCityEditForm(i))}),c()()()}if(o&2){let p=n.$implicit;d(3),b(p.name)}}function $e(o,n){if(o&1){let p=B();s(0,"div",5)(1,"div",6)(2,"p"),l(3,"Name"),c(),s(4,"p"),l(5,"Actions"),c()(),s(6,"div",7)(7,"cdk-virtual-scroll-viewport",8),_("scrolledIndexChange",function(){x(p);let e=y();return M(e.onScroll())}),w(8,Ae,5,1,"div",9),c()()()}if(o&2){let p=y();m("@fadeIn",void 0),d(7),m("itemSize",68),d(1),m("cdkVirtualForOf",p.cities)}}function Ge(o,n){o&1&&v(0,"app-no-data")}var Fe=(()=>{let n=class n extends Qt{constructor(t,e,i,r,h){super(),this.store=t,this.router=e,this.route=i,this.dialogService=r,this.changeRef=h,this.destroyedRef=J(st)}ngOnInit(){this.countryId=Number(this.route.snapshot.paramMap.get("countryId")),this.scrolled$.pipe($(300),nt(this.destroyedRef)).subscribe(()=>this.getOffset()),this.store.dispatch(a.getCitiesOfCountry({countryId:this.countryId,offset:0})),this.countryId&&this.store.dispatch(a.getCountry({id:this.countryId})),this.store.select(ye).pipe(Z(t=>t!==void 0),tt(1)).subscribe(t=>{this.currentCountry=t,this.changeRef.markForCheck()}),this.store.select(fe).pipe(nt(this.destroyedRef)).subscribe(t=>{this.cities=t,this.changeRef.markForCheck()})}getNewBatch(){this.store.dispatch(a.getCitiesOfCountry({countryId:this.countryId,offset:this.offset}))}goToCity(t){this.router.navigate(["/countries/cities",t])}openCityEditForm(t){if(this.countryId!==void 0){let e=this.dialogService.open(Xt,{data:{countryId:this.countryId,cityId:t.id,name:t.name,postalCode:t.postalCode}});this.onDialogClosed(e)}}openCityCreationForm(){if(this.countryId!==void 0){let t=this.dialogService.open(Xt,{data:{countryId:this.countryId}});this.onDialogClosed(t)}}deleteCity(t){this.store.dispatch(a.deleteCity({id:t})),this.offset=0}onDialogClosed(t){t.afterClosed().pipe(tt(1),Z(e=>e===!0)).subscribe(e=>this.offset=0)}};n.\u0275fac=function(e){return new(e||n)(u(k),u(lt),u(Bt),u(bt),u(T))},n.\u0275cmp=E({type:n,selectors:[["app-country-details"]],viewQuery:function(e,i){if(e&1&&zt(Q,5),e&2){let r;Gt(r=qt())&&(i.viewport=r.first)}},standalone:!0,features:[$t,V],decls:5,vars:2,consts:[[1,"wrapper"],["class","heading",4,"ngIf"],["class","table"],[1,"heading"],["mat-raised-button","","color","accent",3,"click"],[1,"table"],[1,"columns"],[1,"list-wrapper"],["CdkScrollable","",3,"itemSize","scrolledIndexChange"],["class","row-wrapper",3,"click",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"row-wrapper",3,"click"],[1,"row","mat-elevation-z2"],[3,"delete","edit"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"mat-card"),w(2,je,5,2,"div",1)(3,$e,9,3,"div",2)(4,Ge,1,0),c()()),e&2&&(d(2),m("ngIf",i.currentCountry),d(1),dt(3,i.cities!==void 0&&i.cities.length>0?3:4))},dependencies:[L,U,A,R,j,ut,pt,mt,Q,Vt,kt],styles:[".row-wrapper[_ngcontent-%COMP%]{margin:0 45px;padding:10px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{padding:10px 0;background-color:#fff;display:flex;justify-content:space-evenly;align-items:center;border-radius:20px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:hover{cursor:pointer}.row-wrapper[_ngcontent-%COMP%]   .row.not-operational[_ngcontent-%COMP%]{background-color:#f0b3b3}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{scrollbar-gutter:stable both-edges}.columns[_ngcontent-%COMP%]{margin:0 76px;display:flex;justify-content:space-evenly}.columns[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;flex:1;font-size:20px;font-weight:500;color:#a9a9a9}.wrapper[_ngcontent-%COMP%]{padding:0 15vw;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:30px 0;background-color:#f2f8ef;width:100%;overflow-y:hidden;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.example-viewport, .table[_ngcontent-%COMP%], app-no-data)[_ngcontent-%COMP%]{margin-left:45px;margin-right:45px}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:0 15px 20px}"],data:{animation:[Ft,de]},changeDetection:0});let o=n;return o})();var ze={countries:[],countriesOffset:0,cityFilters:{}},qe=/^\/countries$/,Be=/^\/countries\/[\d]+$/,Ue=/^\/countries\/cities\/[\d]+$/,De=se(ze,q(a.cityCreated,a.cityDeleted,a.cityEdited,o=>P(D({},o),{cityFilters:P(D({},o.cityFilters),{offset:0}),cities:void 0})),q(a.getCitiesOfCountry,(o,{filters:n})=>P(D({},o),{cityFilters:n})),q(a.getCountries,(o,{offset:n})=>P(D({},o),{countriesOffset:n})),q(a.countryCreated,a.countryDeleted,a.countryEdited,o=>P(D({},o),{countries:[],countriesOffset:0})),q(a.countriesFetched,(o,{countries:n})=>{let p=[...o.countries,...n];return P(D({},o),{countries:p})}),q(a.citiesOfCountryFetched,(o,{cities:n})=>{let t=[...o.cities??[],...n];return P(D({},o),{cities:t})}),q(a.locationsFetched,(o,{locations:n})=>P(D({},o),{locations:n})),q(a.countryFetched,(o,{country:n})=>P(D({},o),{currentlyViewedCountry:n})),q(a.cityFetched,(o,{city:n})=>P(D({},o),{currentlyViewedCity:n})),q(me,(o,{payload:n})=>Qe(o,n.event.url)));function Qe(o,n){return qe.test(n)?P(D({},o),{countries:[],currentlyViewedCity:void 0}):Be.test(n)?P(D({},o),{cities:void 0,currentlyViewedCountry:void 0}):Ue.test(n)?P(D({},o),{currentlyViewedCity:void 0}):o}var Pe=(()=>{let n=class n{constructor(t,e,i){this.actions$=t,this.countriesService=e,this.store=i,this.loadCountries$=I(()=>this.actions$.pipe(F(a.getCountries,a.countryCreated,a.countryDeleted,a.countryEdited),Jt(this.store.select(ge)),te(([r,h])=>this.countriesService.readCountries(h).pipe(C(H=>a.countriesFetched({countries:H})),S(()=>O))))),this.loadCities=I(()=>this.actions$.pipe(F(a.getCitiesOfCountry,a.cityCreated,a.cityDeleted,a.cityEdited),Jt(this.store.select(he)),g(([,r])=>this.countriesService.readCitiesOfCountry(r).pipe(C(h=>a.citiesOfCountryFetched({cities:h})),S(()=>O))))),this.getCountry=I(()=>this.actions$.pipe(F(a.getCountry),g(({id:r})=>this.countriesService.readCountry(r).pipe(C(h=>a.countryFetched({country:h})),S(()=>O))))),this.loadLocations=I(()=>this.actions$.pipe(F(a.getLocations,a.locationCreated,a.locationDeleted,a.locationEdited),g(({cityId:r})=>this.countriesService.readLocationsOfCity(r).pipe(C(h=>a.locationsFetched({locations:h})),S(()=>O))))),this.createCountry=I(()=>this.actions$.pipe(F(a.createCountry),g(({name:r})=>this.countriesService.createCountry(r).pipe(C(()=>a.countryCreated()),S(()=>O))))),this.deleteCountry=I(()=>this.actions$.pipe(F(a.deleteCountry),g(({id:r})=>this.countriesService.deleteCountry(r).pipe(C(()=>a.countryDeleted()),S(()=>O))))),this.editCountry=I(()=>this.actions$.pipe(F(a.editCountry),g(({country:r})=>this.countriesService.editCountry(r).pipe(C(()=>a.countryEdited()),S(()=>O))))),this.createCity=I(()=>this.actions$.pipe(F(a.createCity),g(({city:r})=>this.countriesService.createCity(r).pipe(C(()=>a.cityCreated()),S(()=>O))))),this.getCity=I(()=>this.actions$.pipe(F(a.getCity),g(({id:r})=>this.countriesService.readCity(r).pipe(C(h=>a.cityFetched({city:h})),S(()=>O))))),this.editCity=I(()=>this.actions$.pipe(F(a.editCity),g(({city:r})=>this.countriesService.editCity(r).pipe(C(()=>a.cityEdited()),S(()=>O))))),this.deleteCity=I(()=>this.actions$.pipe(F(a.deleteCity),g(({id:r})=>this.countriesService.deleteCity(r).pipe(C(()=>a.cityDeleted()),S(()=>O))))),this.createLocation=I(()=>this.actions$.pipe(F(a.createLocation),g(({location:r})=>this.countriesService.createLocation(r).pipe(C(()=>a.locationCreated({cityId:r.cityId})),S(()=>O))))),this.editLocation=I(()=>this.actions$.pipe(F(a.editLocation),g(({location:r})=>this.countriesService.editLocation(r).pipe(C(()=>a.locationEdited({cityId:r.cityId})),S(()=>O))))),this.deleteLocation=I(()=>this.actions$.pipe(F(a.deleteLocation),g(({id:r,cityId:h})=>this.countriesService.deleteLocation(r).pipe(C(()=>a.locationDeleted({cityId:h})),S(()=>O)))))}};n.\u0275fac=function(e){return new(e||n)(At(le),At(X),At(k))},n.\u0275prov=ee({token:n,factory:n.\u0275fac});let o=n;return o})();var Ee=(()=>{let n=class n{};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=E({type:n,selectors:[["app-countries"]],standalone:!0,features:[V],decls:1,vars:0,template:function(e,i){e&1&&v(0,"router-outlet")},dependencies:[oe],changeDetection:0});let o=n;return o})();function Ye(o,n){o&1&&(s(0,"mat-error"),l(1,"Location exists"),c())}var Zt=(()=>{let n=class n{uniqueCityNameValidatorFn(){return t=>!t.valueChanges||t.pristine?Lt(null):t.valueChanges.pipe($(400),et(),g(e=>{let{cityId:i}=this.dialogData;return this.service.checkIfLocationNameExists(i,e).pipe(C(r=>[r,e]))}),C(([e,i])=>e&&!Y(this.dialogData.editInfo?.name,i)?{locationExists:!0}:null),ot(),it(()=>this.changeRef.markForCheck()))}constructor(t,e,i,r){this.service=t,this.changeRef=e,this.store=i,this.injector=r,this.dialogData=this.injector.get(Et),this.dialogRef=this.injector.get(Pt),this.matcher=new Dt,this.inEditMode=!1,this.locationForm=new vt({locationName:new z("",{validators:[K.required],asyncValidators:[this.uniqueCityNameValidatorFn().bind(this)]}),address:new z("",{validators:[K.required]}),coordinates:new z(""),description:new z(""),isOperational:new z(!1,{nonNullable:!0})}),this.dialogData.editInfo!==void 0&&(this.inEditMode=!0,this.locationName?.setValue(this.dialogData.editInfo.name),this.address?.setValue(this.dialogData.editInfo.address),this.isOperational?.setValue(this.dialogData.editInfo.isOperational),this.coordinates?.setValue(this.dialogData.editInfo.coordinates??null),this.description?.setValue(this.dialogData.editInfo.description??null))}get locationName(){return this.locationForm.get("locationName")}get coordinates(){return this.locationForm.get("coordinates")}get address(){return this.locationForm.get("address")}get description(){return this.locationForm.get("description")}get isOperational(){return this.locationForm.get("isOperational")}get formPending(){return this.locationForm.pending}createOrEditLocation(){this.inEditMode?this.editLocation():this.createLocation()}editLocation(){let{cityId:t}=this.dialogData,e=this.locationName?.value,i=this.address?.value,r=this.coordinates?.value??void 0,h=this.description?.value??void 0,H=this.isOperational?.value??!1;if(N(t)&&N(this.dialogData.editInfo)&&N(e)&&N(i)){let Ht={id:this.dialogData.editInfo.id,cityId:t,name:e,address:i,coordinates:r,description:h,isOperational:H};this.store.dispatch(a.editLocation({location:Ht})),this.dialogRef.close()}}createLocation(){let{cityId:t}=this.dialogData,e=this.locationName?.value,i=this.address?.value,r=this.coordinates?.value??void 0,h=this.description?.value??void 0,H=this.isOperational?.value??!1;if(N(t)&&N(e)&&N(i)){let Ht={cityId:t,name:e,address:i,coordinates:r,description:h,isOperational:H};this.store.dispatch(a.createLocation({location:Ht})),this.dialogRef.close()}}locationChangedThroughEdit(){let t=this.dialogData.editInfo?.name!==this.locationName?.value,e=this.dialogData.editInfo?.address!==this.address?.value,i=this.dialogData.editInfo?.coordinates!==this.coordinates?.value,r=this.dialogData.editInfo?.description!==this.description?.value,h=this.dialogData.editInfo?.isOperational!==this.isOperational?.value;return t||e||i||r||h}};n.\u0275fac=function(e){return new(e||n)(u(X),u(T),u(k),u(ct))},n.\u0275cmp=E({type:n,selectors:[["app-location-form"]],standalone:!0,features:[V],decls:26,vars:9,consts:[[3,"formGroup","ngSubmit"],[1,"example-full-width"],["formControlName","locationName","matInput","",3,"errorStateMatcher"],[4,"ngIf"],["formControlName","address","matInput","",3,"errorStateMatcher"],["formControlName","coordinates","matInput","",3,"errorStateMatcher"],["formControlName","description","matInput","",3,"errorStateMatcher"],["formControlName","isOperational"],[1,"actions"],["mat-raised-button","","color","accent",3,"disabled"]],template:function(e,i){e&1&&(s(0,"mat-card")(1,"h1"),l(2),c(),s(3,"form",0),_("ngSubmit",function(){return i.createOrEditLocation()}),s(4,"mat-form-field",1)(5,"mat-label"),l(6,"Location name"),c(),v(7,"input",2),w(8,Ye,2,0,"mat-error",3),c(),s(9,"mat-form-field",1)(10,"mat-label"),l(11,"Address"),c(),v(12,"input",4),c(),s(13,"mat-form-field",1)(14,"mat-label"),l(15,"Coordinates"),c(),v(16,"input",5),c(),s(17,"mat-form-field",1)(18,"mat-label"),l(19,"Description"),c(),v(20,"input",6),c(),s(21,"mat-slide-toggle",7),l(22,"Operational"),c(),s(23,"div",8)(24,"button",9),l(25),c()()()()),e&2&&(d(2),b(i.inEditMode?"Edit location":"Add location"),d(1),m("formGroup",i.locationForm),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.locationName==null?null:i.locationName.hasError("locationExists")),d(4),m("errorStateMatcher",i.matcher),d(4),m("errorStateMatcher",i.matcher),d(4),m("errorStateMatcher",i.matcher),d(4),m("disabled",i.locationForm.invalid||i.formPending||!i.locationChangedThroughEdit()),d(1),G(" ",i.inEditMode?"Edit":"Add"," "))},dependencies:[Ot,xt,gt,yt,_t,A,R,j,ht,ft,Ct,It,ne,St,Mt,wt,L,U],styles:["mat-card[_ngcontent-%COMP%]{padding:20px 16px;width:400px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:26px}mat-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:space-between}"],changeDetection:0});let o=n;return o})();function He(o,n){if(o&1){let p=B();s(0,"div",3)(1,"h2"),l(2),c(),s(3,"button",4),_("click",function(){x(p);let e=y();return M(e.openLocationCreationForm())}),l(4," Add location "),c()()}if(o&2){let p=y();m("@fadeIn",void 0),d(2),G("Locations in ",p.currentCity.name,"")}}function Je(o,n){if(o&1){let p=B();s(0,"div",10)(1,"div",11),_("click",function(){let i=x(p).$implicit,r=y(2);return M(r.goToLocationCompositions(i.id,i.name))}),s(2,"p"),l(3),c(),s(4,"p"),l(5),c(),s(6,"p"),l(7),c(),s(8,"p"),l(9),c(),s(10,"app-list-actions",12),_("delete",function(){let i=x(p).$implicit,r=y(2);return M(r.deleteLocation(i.id))})("edit",function(){let i=x(p).$implicit,r=y(2);return M(r.openLocationEditForm(i))}),c()()()}if(o&2){let p=n.$implicit;d(1),ie("not-operational",!p.isOperational),d(2),b(p.name),d(2),b(p.address),d(2),G(" ",p.isOperational?"Operational":"Not operational"," "),d(2),b(p.compositionsSize)}}function Ke(o,n){if(o&1&&(s(0,"div",5)(1,"div",6)(2,"p"),l(3,"Name"),c(),s(4,"p"),l(5,"Address"),c(),s(6,"p"),l(7,"Status"),c(),s(8,"p"),l(9,"Compositions"),c(),s(10,"p"),l(11,"Actions"),c()(),s(12,"div",7)(13,"cdk-virtual-scroll-viewport",8),w(14,Je,11,6,"div",9),c()()()),o&2){let p=y();m("@fadeIn",void 0),d(13),m("itemSize",68),d(1),m("cdkVirtualForOf",p.locations)}}function We(o,n){o&1&&v(0,"app-no-data")}var be=(()=>{let n=class n{constructor(t,e,i,r,h){this.store=t,this.router=e,this.route=i,this.dialogService=r,this.changeRef=h,this.destroyedRef=J(st)}ngOnInit(){this.cityId=Number(this.route.snapshot.paramMap.get("cityId")),this.store.dispatch(a.getLocations({cityId:this.cityId})),this.store.dispatch(a.getCity({id:this.cityId})),this.store.select(Ce).pipe(nt(this.destroyedRef)).subscribe(t=>{this.locations=t,this.changeRef.markForCheck()}),this.store.select(_e).pipe(Z(t=>t!==void 0),tt(1)).subscribe(t=>{this.currentCity=t,this.changeRef.markForCheck()})}goToLocationCompositions(t,e){if(this.currentCity){let i=this.currentCity.id,r=this.currentCity.name;this.router.navigate(["/compositions"],{relativeTo:this.route,queryParams:{cityId:i,cityName:r,locationId:t,locationName:e}})}}openLocationCreationForm(){this.cityId&&this.dialogService.open(Zt,{data:{cityId:this.cityId}})}openLocationEditForm(t){if(this.cityId){let e={cityId:this.cityId,editInfo:{id:t.id,name:t.name,address:t.address,coordinates:t.coordinates,description:t.description,isOperational:t.isOperational}};this.dialogService.open(Zt,{data:e})}}deleteLocation(t){this.cityId&&this.store.dispatch(a.deleteLocation({id:t,cityId:this.cityId}))}};n.\u0275fac=function(e){return new(e||n)(u(k),u(lt),u(Bt),u(bt),u(T))},n.\u0275cmp=E({type:n,selectors:[["app-city-details"]],standalone:!0,features:[V],decls:5,vars:2,consts:[[1,"wrapper"],["class","heading",4,"ngIf"],["class","table"],[1,"heading"],["mat-raised-button","","color","accent",3,"click"],[1,"table"],[1,"columns"],[1,"list-wrapper"],["CdkScrollable","",3,"itemSize"],["class","row-wrapper",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"row-wrapper"],[1,"row","mat-elevation-z2",3,"click"],[3,"delete","edit"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"mat-card"),w(2,He,5,2,"div",1)(3,Ke,15,3,"div",2)(4,We,1,0),c()()),e&2&&(d(2),m("ngIf",i.currentCity),d(1),dt(3,i.locations!==void 0&&i.locations.length>0?3:4))},dependencies:[L,U,A,R,j,ut,pt,mt,Q,Vt,kt],styles:[".row-wrapper[_ngcontent-%COMP%]{margin:0 45px;padding:10px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{padding:10px 0;background-color:#fff;display:flex;justify-content:space-evenly;align-items:center;border-radius:20px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:hover{cursor:pointer}.row-wrapper[_ngcontent-%COMP%]   .row.not-operational[_ngcontent-%COMP%]{background-color:#f0b3b3}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{scrollbar-gutter:stable both-edges}.columns[_ngcontent-%COMP%]{margin:0 76px;display:flex;justify-content:space-evenly}.columns[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;flex:1;font-size:20px;font-weight:500;color:#a9a9a9}.wrapper[_ngcontent-%COMP%]{padding:0 15vw;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .example-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:30px 0;background-color:#f2f8ef;width:100%;overflow-y:hidden;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.example-viewport, .table[_ngcontent-%COMP%], app-no-data)[_ngcontent-%COMP%]{margin-left:45px;margin-right:45px}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:0 15px 20px}"],data:{animation:[Ft]},changeDetection:0});let o=n;return o})();var on=[{path:"",component:Ee,providers:[ce({name:Ut,reducer:De}),pe([Pe])],children:[{path:"",component:Ie},{path:":countryId",component:Fe},{path:"cities/:cityId",component:be}]}];export{on as COUNTRIES_ROUTES};
