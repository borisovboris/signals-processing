import{a as bt}from"./chunk-RXVEORVH.js";import{b as Bt,f as N,g as Ft,h as Y,l as Dt,m as Pt,n as Et,o as Ut,p as Vt}from"./chunk-OTL7X6PS.js";import{a as I,b as de,c as F,d as le,e as pe}from"./chunk-SPCOMQNX.js";import{c as W}from"./chunk-4S6LF2QW.js";import{a as It,b as se}from"./chunk-2JCW2XGL.js";import{a as ot,d as f,e as ne,q as k,t as K,u as re,v as ae,x as q,y as ce}from"./chunk-7FJ4ADOC.js";import{$b as J,B as tt,C as Zt,Ca as B,D as et,E as it,Ea as _,Ec as j,Ga as y,Ja as l,Jb as lt,Ka as b,Kb as Q,L as g,La as G,Lb as pt,Mb as mt,N as Ht,Na as V,P as te,Qb as R,Ra as $t,S as At,Sa as Gt,T as H,Ta as zt,U as E,Vb as A,Wa as U,Wb as ut,X as x,Xb as ft,Y as M,Za as L,Zb as Ct,_b as ht,a as D,ac as gt,b as P,bc as yt,cc as _t,da as at,dc as z,ec as vt,gc as xt,ia as d,ic as Mt,ja as u,jc as wt,ka as T,kc as Ot,l as O,la as ct,lc as St,mb as qt,mc as oe,nb as ie,oa as jt,ob as dt,q as C,qa as m,ra as ee,sa as w,ta as st,u as X,v as S,x as $,xa as s,y as Z,ya as c,za as v}from"./chunk-OWV6CK4N.js";var nt=re(Bt),me=K(nt,o=>o.countries),ue=K(nt,o=>o.cities),fe=K(nt,o=>o.locations),Ce=K(nt,o=>o.cityFilters),he=K(nt,o=>o.countriesOffset),ge=K(nt,o=>o.currentlyViewedCountry),ye=K(nt,o=>o.currentlyViewedCity);var a=ne({source:"Country",events:{"Get Countries":(o=0)=>({offset:o}),"Countries Fetched":f(),"Get country":f(),"Country fetched":f(),"Get Cities Of Country":(o={})=>({filters:o}),"Cities Of Country Fetched":f(),"Get Locations":f(),"Locations Fetched":f(),"Create country":f(),"Country created":f(),"Create city":f(),"City created":f(),"Get city":f(),"City fetched":f(),"Create location":f(),"Location created":f(),"Delete country":f(),"Country deleted":f(),"Delete city":f(),"City deleted":f(),"Delete location":f(),"Location deleted":f(),"Edit country":f(),"Country edited":f(),"Edit city":f(),"City edited":f(),"Edit location":f(),"Location edited":f()}});function be(o,n){o&1&&(s(0,"mat-error"),l(1,"Country already exists"),c())}var Kt=(()=>{let n=class n{uniqueCountryValidatorFn(){return e=>e.valueChanges.pipe($(400),tt(),g(t=>this.service.checkIfCountryExists(t).pipe(C(i=>[i,t]))),C(([t,i])=>t&&!Y(this.dialogData?.name,i)?{countryExists:!0}:null),it(),et(()=>this.changeRef.markForCheck()))}constructor(e,t,i,r){this.service=e,this.changeRef=t,this.store=i,this.injector=r,this.dialogData=H(Pt),this.dialogRef=this.injector.get(Dt),this.matcher=new Ft,this.inEditMode=!1,this.countryForm=new _t({countryName:new z("",{validators:[J.required],asyncValidators:[this.uniqueCountryValidatorFn().bind(this)]})}),this.inEditMode=this.dialogData?.name!==void 0}ngAfterViewInit(){this.dialogData?.name!==void 0&&(this.countryName?.setValue(this.dialogData.name),this.countryForm.markAllAsTouched(),this.countryForm.updateValueAndValidity())}get countryName(){return this.countryForm.get("countryName")}saveCountry(){this.inEditMode?this.editCountry():this.createCountry()}editCountry(){let e=this.dialogData?.id,t=this.countryName?.value;e&&t&&(this.store.dispatch(a.editCountry({country:{id:e,name:t}})),this.dialogRef.close(!0))}createCountry(){let e=this.countryName?.value;N(e)&&(this.store.dispatch(a.createCountry({name:e})),this.dialogRef.close(!0))}countryChangedThroughEdit(){return!Y(this.countryName?.value,this.dialogData?.name)}formPending(){return this.countryForm.pending}};n.\u0275fac=function(t){return new(t||n)(u(W),u(T),u(k),u(at))},n.\u0275cmp=E({type:n,selectors:[["app-country-form"]],standalone:!0,features:[V],decls:12,vars:6,consts:[[3,"formGroup","ngSubmit"],[1,"example-full-width"],["formControlName","countryName","matInput","",3,"errorStateMatcher"],[4,"ngIf"],[1,"actions"],["mat-raised-button","","color","accent",3,"disabled"]],template:function(t,i){t&1&&(s(0,"mat-card")(1,"h1"),l(2),c(),s(3,"form",0),_("ngSubmit",function(){return i.saveCountry()}),s(4,"mat-form-field",1)(5,"mat-label"),l(6,"Country name"),c(),v(7,"input",2),w(8,be,2,0,"mat-error",3),c(),s(9,"div",4)(10,"button",5),l(11),c()()()()),t&2&&(d(2),b(i.inEditMode?"Edit country":"Add country"),d(1),m("formGroup",i.countryForm),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.countryName==null?null:i.countryName.hasError("countryExists")),d(2),m("disabled",i.countryForm.invalid||!i.countryChangedThroughEdit()||i.formPending()),d(1),G(" ",i.inEditMode?"Edit":"Add"," "))},dependencies:[wt,vt,ht,gt,yt,j,R,A,Ct,ut,ft,St,Ot,xt,Mt,L,U],styles:["mat-card[_ngcontent-%COMP%]{padding:20px 16px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:26px}mat-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:space-between}"],changeDetection:0});let o=n;return o})();function Ve(o,n){if(o&1){let p=B();s(0,"div",9),_("click",function(){let i=x(p).$implicit,r=y(2);return M(r.goToDetails(i.id))}),s(1,"div",10)(2,"p"),l(3),c(),s(4,"app-list-actions",11),_("delete",function(){let i=x(p).$implicit,r=y(2);return M(r.deleteCountry(i.id))})("edit",function(){let i=x(p).$implicit,r=y(2);return M(r.openCountryFormForEdit(i.id,i.name))}),c()()()}if(o&2){let p=n.$implicit;d(3),b(p.name)}}function ke(o,n){if(o&1){let p=B();s(0,"div",4)(1,"div",5)(2,"p"),l(3,"Name"),c(),s(4,"p"),l(5,"Actions"),c()(),s(6,"div",6)(7,"cdk-virtual-scroll-viewport",7),_("scrolledIndexChange",function(){x(p);let t=y();return M(t.onScroll())}),w(8,Ve,5,1,"div",8),c()()()}if(o&2){let p=y();m("@fadeIn",void 0),d(7),m("itemSize",68),d(1),m("cdkVirtualForOf",p.countries)}}function Ne(o,n){o&1&&v(0,"app-no-data")}var Se=(()=>{let n=class n extends Ut{constructor(e,t,i,r){super(),this.store=e,this.router=t,this.dialogService=i,this.changeRef=r,this.destroyedRef=H(ct)}ngOnInit(){this.store.dispatch(a.getCountries()),this.scrolled$.pipe($(300)).subscribe(()=>this.getOffset()),this.store.select(me).pipe(ot(this.destroyedRef)).subscribe(e=>{this.countries=e,this.changeRef.markForCheck()})}getNewBatch(){this.store.dispatch(a.getCountries(this.offset))}goToDetails(e){this.router.navigate(["countries",e])}openCountryFormForCreation(){let e=this.dialogService.open(Kt);this.onDialogClosed(e)}openCountryFormForEdit(e,t){let i={id:e,name:t},r=this.dialogService.open(Kt,{data:i});this.onDialogClosed(r)}onDialogClosed(e){e.afterClosed().pipe(Z(1),X(t=>t===!0)).subscribe(()=>this.offset=0)}deleteCountry(e){this.store.dispatch(a.deleteCountry({id:e})),this.offset=0}};n.\u0275fac=function(t){return new(t||n)(u(k),u(dt),u(Et),u(T))},n.\u0275cmp=E({type:n,selectors:[["app-country-list"]],viewQuery:function(t,i){if(t&1&&Gt(Q,5),t&2){let r;$t(r=zt())&&(i.viewport=r.first)}},standalone:!0,features:[jt,V],decls:9,vars:1,consts:[[1,"wrapper"],[1,"heading"],["mat-raised-button","","color","accent",3,"click"],["class","table"],[1,"table"],[1,"columns"],[1,"list-wrapper"],["CdkScrollable","",3,"itemSize","scrolledIndexChange"],["class","row-wrapper",3,"click",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"row-wrapper",3,"click"],[1,"row","mat-elevation-z2"],[3,"delete","edit"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"mat-card")(2,"div",1)(3,"h2"),l(4,"Countries"),c(),s(5,"button",2),_("click",function(){return i.openCountryFormForCreation()}),l(6," Add country "),c()(),w(7,ke,9,3,"div",3)(8,Ne,1,0),c()()),t&2&&(d(7),st(7,i.countries!==void 0&&i.countries.length>0?7:8))},dependencies:[L,j,R,A,mt,lt,pt,Q,bt,Vt],styles:[".row-wrapper[_ngcontent-%COMP%]{margin:0 45px;padding:10px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{padding:10px 0;background-color:#fff;display:flex;justify-content:space-evenly;align-items:center;border-radius:20px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:hover{cursor:pointer}.row-wrapper[_ngcontent-%COMP%]   .row.not-operational[_ngcontent-%COMP%]{background-color:#f0b3b3}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{scrollbar-gutter:stable both-edges}.columns[_ngcontent-%COMP%]{margin:0 76px;display:flex;justify-content:space-evenly}.columns[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;flex:1;font-size:20px;font-weight:500;color:#a9a9a9}.wrapper[_ngcontent-%COMP%]{padding:0 15vw;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}mat-card[_ngcontent-%COMP%]{padding:30px 0;background-color:#f2f8ef;height:100%;width:100%;overflow-y:hidden}mat-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.example-viewport, .table[_ngcontent-%COMP%], app-no-data)[_ngcontent-%COMP%]{margin-left:45px;margin-right:45px}mat-card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:0 15px 20px}"],data:{animation:[It]},changeDetection:0});let o=n;return o})();function Te(o,n){o&1&&(s(0,"mat-error"),l(1,"City name exists"),c())}function Le(o,n){o&1&&(s(0,"mat-error"),l(1,"Postal code exists"),c())}var Wt=(()=>{let n=class n{uniqueCityNameValidatorFn(){return e=>e.valueChanges.pipe($(400),tt(),g(t=>{let{countryId:i}=this.dialogData;return this.service.checkIfCityExists(i,t).pipe(C(r=>[r,t]))}),C(([t,i])=>t&&!Y(this.dialogData.name,i)?{countryExists:!0}:null),it(),et(()=>this.changeRef.markForCheck()))}uniquePostalCodeValidatorFn(){return e=>e.valueChanges.pipe($(400),tt(),g(t=>{let{countryId:i}=this.dialogData;return this.service.checkIfPostalCodeExists(i,t).pipe(C(r=>[r,t]))}),C(([t,i])=>t&&!Y(this.dialogData.postalCode,i)?{postalCodeExists:!0}:null),it(),et(()=>this.changeRef.markForCheck()))}constructor(e,t,i,r){this.service=e,this.changeRef=t,this.store=i,this.injector=r,this.dialogData=this.injector.get(Pt),this.dialogRef=this.injector.get(Dt),this.matcher=new Ft,this.inEditMode=!1,this.cityForm=new _t({cityName:new z("",{validators:[J.required],asyncValidators:[this.uniqueCityNameValidatorFn().bind(this)]}),postalCode:new z("",{validators:[J.required],asyncValidators:[this.uniquePostalCodeValidatorFn().bind(this)]})}),this.dialogData.name!==void 0&&(this.inEditMode=!0)}ngAfterViewInit(){let e=this.dialogData.name,t=this.dialogData.postalCode;e&&t&&(this.cityForm.get("cityName")?.setValue(e),this.cityForm.get("postalCode")?.setValue(t),this.cityForm.markAllAsTouched(),this.cityForm.updateValueAndValidity())}get cityName(){return this.cityForm.get("cityName")}get postalCode(){return this.cityForm.get("postalCode")}get formPending(){return this.cityForm.pending}saveCity(){this.inEditMode?this.editCity():this.createCity()}editCity(){let e=this.cityName?.value,t=this.postalCode?.value,{countryId:i}=this.dialogData,{cityId:r}=this.dialogData;e&&t&&i&&r&&(this.store.dispatch(a.editCity({city:{name:e,postalCode:t,countryId:i,id:r}})),this.dialogRef.close(!0))}createCity(){let e=this.cityName?.value,t=this.postalCode?.value,{countryId:i}=this.dialogData;if(N(e)&&N(t)){let r={name:e,postalCode:t,countryId:i};this.store.dispatch(a.createCity({city:r})),this.dialogRef.close(!0)}}get cityChangedThroughEdit(){let e=!Y(this.cityName?.value,this.dialogData?.name),t=!Y(this.postalCode?.value,this.dialogData?.postalCode);return e||t}};n.\u0275fac=function(t){return new(t||n)(u(W),u(T),u(k),u(at))},n.\u0275cmp=E({type:n,selectors:[["app-city-form"]],standalone:!0,features:[V],decls:17,vars:8,consts:[[3,"formGroup","ngSubmit"],[1,"example-full-width"],["formControlName","cityName","matInput","",3,"errorStateMatcher"],[4,"ngIf"],["formControlName","postalCode","matInput","",3,"errorStateMatcher"],[1,"actions"],["mat-raised-button","","color","accent",3,"disabled"]],template:function(t,i){t&1&&(s(0,"mat-card")(1,"h1"),l(2),c(),s(3,"form",0),_("ngSubmit",function(){return i.saveCity()}),s(4,"mat-form-field",1)(5,"mat-label"),l(6,"City name"),c(),v(7,"input",2),w(8,Te,2,0,"mat-error",3),c(),s(9,"mat-form-field",1)(10,"mat-label"),l(11,"Postal code"),c(),v(12,"input",4),w(13,Le,2,0,"mat-error",3),c(),s(14,"div",5)(15,"button",6),l(16),c()()()()),t&2&&(d(2),b(i.inEditMode?"Edit city":"Add city"),d(1),m("formGroup",i.cityForm),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.cityName==null?null:i.cityName.hasError("countryExists")),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.postalCode==null?null:i.postalCode.hasError("postalCodeExists")),d(2),m("disabled",i.cityForm.invalid||i.formPending||!i.cityChangedThroughEdit),d(1),G(" ",i.inEditMode?"Edit":"Add"," "))},dependencies:[wt,vt,ht,gt,yt,j,R,A,Ct,ut,ft,St,Ot,xt,Mt,L,U],styles:["mat-card[_ngcontent-%COMP%]{padding:20px 16px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:26px}mat-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:space-between}"],changeDetection:0});let o=n;return o})();function Re(o,n){if(o&1){let p=B();s(0,"div",3)(1,"h2"),l(2),c(),s(3,"button",4),_("click",function(){x(p);let t=y();return M(t.openCityCreationForm())}),l(4," Add city "),c()()}if(o&2){let p=y();d(1),m("@fadeIn",void 0),d(1),G("Cities in ",p.currentCountry.name,"")}}function Ae(o,n){if(o&1){let p=B();s(0,"div",10),_("click",function(){let i=x(p).$implicit,r=y(2);return M(r.goToCity(i.id))}),s(1,"div",11)(2,"p"),l(3),c(),s(4,"app-list-actions",12),_("delete",function(){let i=x(p).$implicit,r=y(2);return M(r.deleteCity(i.id))})("edit",function(){let i=x(p).$implicit,r=y(2);return M(r.openCityEditForm(i))}),c()()()}if(o&2){let p=n.$implicit;d(3),b(p.name)}}function je(o,n){if(o&1){let p=B();s(0,"div",5)(1,"div",6)(2,"p"),l(3,"Name"),c(),s(4,"p"),l(5,"Actions"),c()(),s(6,"div",7)(7,"cdk-virtual-scroll-viewport",8),_("scrolledIndexChange",function(){x(p);let t=y();return M(t.onScroll())}),w(8,Ae,5,1,"div",9),c()()()}if(o&2){let p=y();m("@fadeIn",void 0),d(7),m("itemSize",68),d(1),m("cdkVirtualForOf",p.cities)}}function $e(o,n){o&1&&v(0,"app-no-data")}var Ie=(()=>{let n=class n extends Ut{constructor(e,t,i,r,h){super(),this.store=e,this.router=t,this.route=i,this.dialogService=r,this.changeRef=h,this.destroyedRef=H(ct)}ngOnInit(){this.countryId=Number(this.route.snapshot.paramMap.get("countryId")),this.scrolled$.pipe($(300),ot(this.destroyedRef)).subscribe(()=>this.getOffset()),this.store.dispatch(a.getCitiesOfCountry({countryId:this.countryId,offset:0})),this.countryId&&this.store.dispatch(a.getCountry({id:this.countryId})),this.store.select(ge).pipe(X(e=>e!==void 0),Z(1)).subscribe(e=>{this.currentCountry=e,this.changeRef.markForCheck()}),this.store.select(ue).pipe(ot(this.destroyedRef)).subscribe(e=>{this.cities=e,this.changeRef.markForCheck()})}getNewBatch(){this.store.dispatch(a.getCitiesOfCountry({countryId:this.countryId,offset:this.offset}))}goToCity(e){this.router.navigate(["/countries/cities",e])}openCityEditForm(e){if(this.countryId!==void 0){let t=this.dialogService.open(Wt,{data:{countryId:this.countryId,cityId:e.id,name:e.name,postalCode:e.postalCode}});this.onDialogClosed(t)}}openCityCreationForm(){if(this.countryId!==void 0){let e=this.dialogService.open(Wt,{data:{countryId:this.countryId}});this.onDialogClosed(e)}}deleteCity(e){this.store.dispatch(a.deleteCity({id:e})),this.offset=0}onDialogClosed(e){e.afterClosed().pipe(Z(1),X(t=>t===!0)).subscribe(t=>this.offset=0)}};n.\u0275fac=function(t){return new(t||n)(u(k),u(dt),u(qt),u(Et),u(T))},n.\u0275cmp=E({type:n,selectors:[["app-country-details"]],viewQuery:function(t,i){if(t&1&&Gt(Q,5),t&2){let r;$t(r=zt())&&(i.viewport=r.first)}},standalone:!0,features:[jt,V],decls:5,vars:2,consts:[[1,"wrapper"],["class","heading",4,"ngIf"],["class","table"],[1,"heading"],["mat-raised-button","","color","accent",3,"click"],[1,"table"],[1,"columns"],[1,"list-wrapper"],["CdkScrollable","",3,"itemSize","scrolledIndexChange"],["class","row-wrapper",3,"click",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"row-wrapper",3,"click"],[1,"row","mat-elevation-z2"],[3,"delete","edit"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"mat-card"),w(2,Re,5,2,"div",1)(3,je,9,3,"div",2)(4,$e,1,0),c()()),t&2&&(d(2),m("ngIf",i.currentCountry),d(1),st(3,i.cities!==void 0&&i.cities.length>0?3:4))},dependencies:[L,U,j,R,A,mt,lt,pt,Q,bt,Vt],styles:[".row-wrapper[_ngcontent-%COMP%]{margin:0 45px;padding:10px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{padding:10px 0;background-color:#fff;display:flex;justify-content:space-evenly;align-items:center;border-radius:20px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:hover{cursor:pointer}.row-wrapper[_ngcontent-%COMP%]   .row.not-operational[_ngcontent-%COMP%]{background-color:#f0b3b3}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{scrollbar-gutter:stable both-edges}.columns[_ngcontent-%COMP%]{margin:0 76px;display:flex;justify-content:space-evenly}.columns[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;flex:1;font-size:20px;font-weight:500;color:#a9a9a9}.wrapper[_ngcontent-%COMP%]{padding:0 15vw;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:30px 0;background-color:#f2f8ef;width:100%;overflow-y:hidden;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.example-viewport, .table[_ngcontent-%COMP%], app-no-data)[_ngcontent-%COMP%]{margin-left:45px;margin-right:45px}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:0 15px 20px}"],data:{animation:[It,se]},changeDetection:0});let o=n;return o})();var Ge={countries:[],countriesOffset:0,cityFilters:{}},ze=/^\/countries$/,qe=/^\/countries\/[\d]+$/,Be=/^\/countries\/cities\/[\d]+$/,Fe=ce(Ge,q(a.cityCreated,a.cityDeleted,a.cityEdited,o=>P(D({},o),{cityFilters:P(D({},o.cityFilters),{offset:0}),cities:void 0})),q(a.getCitiesOfCountry,(o,{filters:n})=>P(D({},o),{cityFilters:n})),q(a.getCountries,(o,{offset:n})=>P(D({},o),{countriesOffset:n})),q(a.countryCreated,a.countryDeleted,a.countryEdited,o=>P(D({},o),{countries:[],countriesOffset:0})),q(a.countriesFetched,(o,{countries:n})=>{let p=[...o.countries,...n];return P(D({},o),{countries:p})}),q(a.citiesOfCountryFetched,(o,{cities:n})=>{let e=[...o.cities??[],...n];return P(D({},o),{cities:e})}),q(a.locationsFetched,(o,{locations:n})=>P(D({},o),{locations:n})),q(a.countryFetched,(o,{country:n})=>P(D({},o),{currentlyViewedCountry:n})),q(a.cityFetched,(o,{city:n})=>P(D({},o),{currentlyViewedCity:n})),q(pe,(o,{payload:n})=>Ue(o,n.event.url)));function Ue(o,n){return ze.test(n)?P(D({},o),{countries:[],currentlyViewedCity:void 0}):qe.test(n)?P(D({},o),{cities:void 0,currentlyViewedCountry:void 0}):Be.test(n)?P(D({},o),{currentlyViewedCity:void 0}):o}var De=(()=>{let n=class n{constructor(e,t,i){this.actions$=e,this.countriesService=t,this.store=i,this.loadCountries$=I(()=>this.actions$.pipe(F(a.getCountries,a.countryCreated,a.countryDeleted,a.countryEdited),Ht(this.store.select(he)),Zt(([r,h])=>this.countriesService.readCountries(h).pipe(C(Tt=>a.countriesFetched({countries:Tt})),S(()=>O))))),this.loadCities=I(()=>this.actions$.pipe(F(a.getCitiesOfCountry,a.cityCreated,a.cityDeleted,a.cityEdited),Ht(this.store.select(Ce)),g(([,r])=>this.countriesService.readCitiesOfCountry(r).pipe(C(h=>a.citiesOfCountryFetched({cities:h})),S(()=>O))))),this.getCountry=I(()=>this.actions$.pipe(F(a.getCountry),g(({id:r})=>this.countriesService.readCountry(r).pipe(C(h=>a.countryFetched({country:h})),S(()=>O))))),this.loadLocations=I(()=>this.actions$.pipe(F(a.getLocations,a.locationCreated,a.locationDeleted,a.locationEdited),g(({cityId:r})=>this.countriesService.readLocationsOfCity(r).pipe(C(h=>a.locationsFetched({locations:h})),S(()=>O))))),this.createCountry=I(()=>this.actions$.pipe(F(a.createCountry),g(({name:r})=>this.countriesService.createCountry(r).pipe(C(()=>a.countryCreated()),S(()=>O))))),this.deleteCountry=I(()=>this.actions$.pipe(F(a.deleteCountry),g(({id:r})=>this.countriesService.deleteCountry(r).pipe(C(()=>a.countryDeleted()),S(()=>O))))),this.editCountry=I(()=>this.actions$.pipe(F(a.editCountry),g(({country:r})=>this.countriesService.editCountry(r).pipe(C(()=>a.countryEdited()),S(()=>O))))),this.createCity=I(()=>this.actions$.pipe(F(a.createCity),g(({city:r})=>this.countriesService.createCity(r).pipe(C(()=>a.cityCreated()),S(()=>O))))),this.getCity=I(()=>this.actions$.pipe(F(a.getCity),g(({id:r})=>this.countriesService.readCity(r).pipe(C(h=>a.cityFetched({city:h})),S(()=>O))))),this.editCity=I(()=>this.actions$.pipe(F(a.editCity),g(({city:r})=>this.countriesService.editCity(r).pipe(C(()=>a.cityEdited()),S(()=>O))))),this.deleteCity=I(()=>this.actions$.pipe(F(a.deleteCity),g(({id:r})=>this.countriesService.deleteCity(r).pipe(C(()=>a.cityDeleted()),S(()=>O))))),this.createLocation=I(()=>this.actions$.pipe(F(a.createLocation),g(({location:r})=>this.countriesService.createLocation(r).pipe(C(()=>a.locationCreated({cityId:r.cityId})),S(()=>O))))),this.editLocation=I(()=>this.actions$.pipe(F(a.editLocation),g(({location:r})=>this.countriesService.editLocation(r).pipe(C(()=>a.locationEdited({cityId:r.cityId})),S(()=>O))))),this.deleteLocation=I(()=>this.actions$.pipe(F(a.deleteLocation),g(({id:r,cityId:h})=>this.countriesService.deleteLocation(r).pipe(C(()=>a.locationDeleted({cityId:h})),S(()=>O)))))}};n.\u0275fac=function(t){return new(t||n)(At(de),At(W),At(k))},n.\u0275prov=te({token:n,factory:n.\u0275fac});let o=n;return o})();var Pe=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=E({type:n,selectors:[["app-countries"]],standalone:!0,features:[V],decls:1,vars:0,template:function(t,i){t&1&&v(0,"router-outlet")},dependencies:[ie],changeDetection:0});let o=n;return o})();function Qe(o,n){o&1&&(s(0,"mat-error"),l(1,"Location exists"),c())}var Xt=(()=>{let n=class n{uniqueCityNameValidatorFn(){return e=>e.valueChanges.pipe($(400),tt(),g(t=>{let{cityId:i}=this.dialogData;return this.service.checkIfLocationNameExists(i,t).pipe(C(r=>[r,t]))}),C(([t,i])=>t&&!Y(this.dialogData.editInfo?.name,i)?{locationExists:!0}:null),it(),et(()=>this.changeRef.markForCheck()))}constructor(e,t,i,r){this.service=e,this.changeRef=t,this.store=i,this.injector=r,this.dialogData=this.injector.get(Pt),this.dialogRef=this.injector.get(Dt),this.matcher=new Ft,this.inEditMode=!1,this.locationForm=new _t({locationName:new z("",{validators:[J.required],asyncValidators:[this.uniqueCityNameValidatorFn().bind(this)]}),address:new z("",{validators:[J.required]}),coordinates:new z(""),description:new z(""),isOperational:new z(!1,{nonNullable:!0})}),this.inEditMode=this.dialogData.editInfo!==void 0}ngAfterViewInit(){this.dialogData.editInfo!==void 0&&(this.locationName?.setValue(this.dialogData.editInfo.name),this.address?.setValue(this.dialogData.editInfo.address),this.isOperational?.setValue(this.dialogData.editInfo.isOperational),this.coordinates?.setValue(this.dialogData.editInfo.coordinates??null),this.description?.setValue(this.dialogData.editInfo.description??null),this.locationForm.markAllAsTouched(),this.locationForm.updateValueAndValidity())}get locationName(){return this.locationForm.get("locationName")}get coordinates(){return this.locationForm.get("coordinates")}get address(){return this.locationForm.get("address")}get description(){return this.locationForm.get("description")}get isOperational(){return this.locationForm.get("isOperational")}get formPending(){return this.locationForm.pending}createOrEditLocation(){this.inEditMode?this.editLocation():this.createLocation()}editLocation(){let{cityId:e}=this.dialogData,t=this.locationName?.value,i=this.address?.value,r=this.coordinates?.value??void 0,h=this.description?.value??void 0,Tt=this.isOperational?.value??!1;if(N(e)&&N(this.dialogData.editInfo)&&N(t)&&N(i)){let Yt={id:this.dialogData.editInfo.id,cityId:e,name:t,address:i,coordinates:r,description:h,isOperational:Tt};this.store.dispatch(a.editLocation({location:Yt})),this.dialogRef.close()}}createLocation(){let{cityId:e}=this.dialogData,t=this.locationName?.value,i=this.address?.value,r=this.coordinates?.value??void 0,h=this.description?.value??void 0,Tt=this.isOperational?.value??!1;if(N(e)&&N(t)&&N(i)){let Yt={cityId:e,name:t,address:i,coordinates:r,description:h,isOperational:Tt};this.store.dispatch(a.createLocation({location:Yt})),this.dialogRef.close()}}locationChangedThroughEdit(){let e=this.dialogData.editInfo?.name!==this.locationName?.value,t=this.dialogData.editInfo?.address!==this.address?.value,i=this.dialogData.editInfo?.coordinates!==this.coordinates?.value,r=this.dialogData.editInfo?.description!==this.description?.value,h=this.dialogData.editInfo?.isOperational!==this.isOperational?.value;return e||t||i||r||h}};n.\u0275fac=function(t){return new(t||n)(u(W),u(T),u(k),u(at))},n.\u0275cmp=E({type:n,selectors:[["app-location-form"]],standalone:!0,features:[V],decls:26,vars:9,consts:[[3,"formGroup","ngSubmit"],[1,"example-full-width"],["formControlName","locationName","matInput","",3,"errorStateMatcher"],[4,"ngIf"],["formControlName","address","matInput","",3,"errorStateMatcher"],["formControlName","coordinates","matInput","",3,"errorStateMatcher"],["formControlName","description","matInput","",3,"errorStateMatcher"],["formControlName","isOperational"],[1,"actions"],["mat-raised-button","","color","accent",3,"disabled"]],template:function(t,i){t&1&&(s(0,"mat-card")(1,"h1"),l(2),c(),s(3,"form",0),_("ngSubmit",function(){return i.createOrEditLocation()}),s(4,"mat-form-field",1)(5,"mat-label"),l(6,"Location name"),c(),v(7,"input",2),w(8,Qe,2,0,"mat-error",3),c(),s(9,"mat-form-field",1)(10,"mat-label"),l(11,"Address"),c(),v(12,"input",4),c(),s(13,"mat-form-field",1)(14,"mat-label"),l(15,"Coordinates"),c(),v(16,"input",5),c(),s(17,"mat-form-field",1)(18,"mat-label"),l(19,"Description"),c(),v(20,"input",6),c(),s(21,"mat-slide-toggle",7),l(22,"Operational"),c(),s(23,"div",8)(24,"button",9),l(25),c()()()()),t&2&&(d(2),b(i.inEditMode?"Edit location":"Add location"),d(1),m("formGroup",i.locationForm),d(4),m("errorStateMatcher",i.matcher),d(1),m("ngIf",i.locationName==null?null:i.locationName.hasError("locationExists")),d(4),m("errorStateMatcher",i.matcher),d(4),m("errorStateMatcher",i.matcher),d(4),m("errorStateMatcher",i.matcher),d(4),m("disabled",i.locationForm.invalid||i.formPending||!i.locationChangedThroughEdit()),d(1),G(" ",i.inEditMode?"Edit":"Add"," "))},dependencies:[wt,vt,ht,gt,yt,j,R,A,Ct,ut,ft,St,oe,Ot,xt,Mt,L,U],styles:["mat-card[_ngcontent-%COMP%]{padding:20px 16px;width:400px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:26px}mat-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:space-between}"],changeDetection:0});let o=n;return o})();function Ye(o,n){if(o&1){let p=B();s(0,"div",3)(1,"h2"),l(2),c(),s(3,"button",4),_("click",function(){x(p);let t=y();return M(t.openLocationCreationForm())}),l(4," Add location "),c()()}if(o&2){let p=y();m("@fadeIn",void 0),d(2),G("Locations in ",p.currentCity.name,"")}}function He(o,n){if(o&1){let p=B();s(0,"div",10)(1,"div",11),_("click",function(){let i=x(p).$implicit,r=y(2);return M(r.goToLocationCompositions(i.id,i.name))}),s(2,"p"),l(3),c(),s(4,"p"),l(5),c(),s(6,"p"),l(7),c(),s(8,"p"),l(9),c(),s(10,"app-list-actions",12),_("delete",function(){let i=x(p).$implicit,r=y(2);return M(r.deleteLocation(i.id))})("edit",function(){let i=x(p).$implicit,r=y(2);return M(r.openLocationEditForm(i))}),c()()()}if(o&2){let p=n.$implicit;d(1),ee("not-operational",!p.isOperational),d(2),b(p.name),d(2),b(p.address),d(2),G(" ",p.isOperational?"Operational":"Not operational"," "),d(2),b(p.compositionsSize)}}function Je(o,n){if(o&1&&(s(0,"div",5)(1,"div",6)(2,"p"),l(3,"Name"),c(),s(4,"p"),l(5,"Address"),c(),s(6,"p"),l(7,"Status"),c(),s(8,"p"),l(9,"Compositions"),c(),s(10,"p"),l(11,"Actions"),c()(),s(12,"div",7)(13,"cdk-virtual-scroll-viewport",8),w(14,He,11,6,"div",9),c()()()),o&2){let p=y();m("@fadeIn",void 0),d(13),m("itemSize",68),d(1),m("cdkVirtualForOf",p.locations)}}function Ke(o,n){o&1&&v(0,"app-no-data")}var Ee=(()=>{let n=class n{constructor(e,t,i,r,h){this.store=e,this.router=t,this.route=i,this.dialogService=r,this.changeRef=h,this.destroyedRef=H(ct)}ngOnInit(){this.cityId=Number(this.route.snapshot.paramMap.get("cityId")),this.store.dispatch(a.getLocations({cityId:this.cityId})),this.store.dispatch(a.getCity({id:this.cityId})),this.store.select(fe).pipe(ot(this.destroyedRef)).subscribe(e=>{this.locations=e,this.changeRef.markForCheck()}),this.store.select(ye).pipe(X(e=>e!==void 0),Z(1)).subscribe(e=>{this.currentCity=e,this.changeRef.markForCheck()})}goToLocationCompositions(e,t){if(this.currentCity){let i=this.currentCity.id,r=this.currentCity.name;this.router.navigate(["/compositions"],{relativeTo:this.route,queryParams:{cityId:i,cityName:r,locationId:e,locationName:t}})}}openLocationCreationForm(){this.cityId&&this.dialogService.open(Xt,{data:{cityId:this.cityId}})}openLocationEditForm(e){if(this.cityId){let t={cityId:this.cityId,editInfo:{id:e.id,name:e.name,address:e.address,coordinates:e.coordinates,description:e.description,isOperational:e.isOperational}};this.dialogService.open(Xt,{data:t})}}deleteLocation(e){this.cityId&&this.store.dispatch(a.deleteLocation({id:e,cityId:this.cityId}))}};n.\u0275fac=function(t){return new(t||n)(u(k),u(dt),u(qt),u(Et),u(T))},n.\u0275cmp=E({type:n,selectors:[["app-city-details"]],standalone:!0,features:[V],decls:5,vars:2,consts:[[1,"wrapper"],["class","heading",4,"ngIf"],["class","table"],[1,"heading"],["mat-raised-button","","color","accent",3,"click"],[1,"table"],[1,"columns"],[1,"list-wrapper"],["CdkScrollable","",3,"itemSize"],["class","row-wrapper",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"row-wrapper"],[1,"row","mat-elevation-z2",3,"click"],[3,"delete","edit"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"mat-card"),w(2,Ye,5,2,"div",1)(3,Je,15,3,"div",2)(4,Ke,1,0),c()()),t&2&&(d(2),m("ngIf",i.currentCity),d(1),st(3,i.locations!==void 0&&i.locations.length>0?3:4))},dependencies:[L,U,j,R,A,mt,lt,pt,Q,bt,Vt],styles:[".row-wrapper[_ngcontent-%COMP%]{margin:0 45px;padding:10px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{padding:10px 0;background-color:#fff;display:flex;justify-content:space-evenly;align-items:center;border-radius:20px}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row-wrapper[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:hover{cursor:pointer}.row-wrapper[_ngcontent-%COMP%]   .row.not-operational[_ngcontent-%COMP%]{background-color:#f0b3b3}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{scrollbar-gutter:stable both-edges}.columns[_ngcontent-%COMP%]{margin:0 76px;display:flex;justify-content:space-evenly}.columns[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;flex:1;font-size:20px;font-weight:500;color:#a9a9a9}.wrapper[_ngcontent-%COMP%]{padding:0 15vw;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   .example-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:30px 0;background-color:#f2f8ef;width:100%;overflow-y:hidden;height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.example-viewport, .table[_ngcontent-%COMP%], app-no-data)[_ngcontent-%COMP%]{margin-left:45px;margin-right:45px}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .list-wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{min-height:100%}.wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:0 15px 20px}"],data:{animation:[It]},changeDetection:0});let o=n;return o})();var en=[{path:"",component:Pe,providers:[ae({name:Bt,reducer:Fe}),le([De])],children:[{path:"",component:Se},{path:":countryId",component:Ie},{path:"cities/:cityId",component:Ee}]}];export{en as COUNTRIES_ROUTES};
